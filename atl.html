<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ATLDetails Records</title>
  <style>
    body {
  font-family: Arial, sans-serif;
  background: #f8f9fa;
  padding: 20px;
}

.container {
  max-width: 1000px;
  margin: auto;
  background: #fff;
  padding: 30px;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

h1 {
  margin-bottom: 20px;
}

.search-bar {
  display: flex;
  margin-bottom: 15px;
}

.search-bar input {
  flex: 1;
  padding: 10px;
  font-size: 16px;
  margin-right: 10px;
}

.search-bar button {
  padding: 10px 15px;
  background: #007bff;
  color: rgb(255, 255, 255);
  border: none;
  cursor: pointer;
}

.add-btn {
  background-color: #007bff;
  color: white;
  padding: 10px 16px;
  border: none;
  margin-bottom: 15px;
  cursor: pointer;
}

table {
  width: 100%;
  border-collapse: collapse;
}

table th,
table td {
  border: 1px solid #dee2e6;
  padding: 10px;
  text-align: left;
}

table th {
  background: #f1f1f1;
}

.edit {
  background-color: #ffc107;
  border: none;
  padding: 6px 10px;
  margin-right: 5px;
  color: black;
  cursor: pointer;
}

.delete {
  background-color: #dc3545;
  border: none;
  padding: 6px 10px;
  color: white;
  cursor: pointer;
}

a {
  color: #007bff;
  text-decoration: none;
}

  </style>
</head>
<body>
  <div class="container">
    <h1>ATLDetails Records</h1>
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Search by School Name or ATL Code">
      <button onclick="searchTable()">Search</button>
    </div>
   <a href="editatl.html"> <button class="add-btn">Add New ATL Record</button></a>

    <table>
      <thead>
        <tr>
          <th>ATL Code</th>
          <th>School Name</th>
          <th>Principal</th>
          <th>ATL Incharge</th>
          <th>Reg Phone</th>
          <th>Comment</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="atlTable">
        <!-- Data will be loaded dynamically -->
      </tbody>
    </table>
  </div>

  <script>
    // Function to load ATL records
    function loadATLRecords() {
      fetch('fetch_atl_details.php')
        .then(response => response.json())
        .then(response => {
          if (response.status === 'success') {
            const tableBody = document.getElementById('atlTable');
            tableBody.innerHTML = ''; // Clear existing rows
            
            response.data.forEach(record => {
              const row = document.createElement('tr');
              row.innerHTML = `
                <td>${record.atl_code || ''}</td>
                <td>${record.school_name || ''}</td>
                <td>${record.principal_name_phone || ''}</td>
                <td>${record.atl_incharge_phone || ''}</td>
                <td>${record.reg_phone || ''}</td>
                <td>${record.vcomment || ''}</td>
                <td>
                  <button class="edit" onclick="editRecord('${record.id}')">Edit</button>
                  <button class="delete" onclick="deleteRecord('${record.id}')">Delete</button>
                </td>
              `;
              tableBody.appendChild(row);
            });
          } else {
            alert('Error loading records: ' + response.message);
          }
        })
        .catch(error => {
          console.error('Error loading records:', error);
          alert('Error loading records. Please try again.');
        });
    }

    // Function to delete a record
    function deleteRecord(id) {
      if (confirm('Are you sure you want to delete this record?')) {
        const formData = new FormData();
        formData.append('id', id);
        
        fetch('delete_atl_details.php', {
          method: 'POST',
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            alert('Record deleted successfully');
            loadATLRecords(); // Reload the table
          } else {
            alert('Error: ' + data.message);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Error deleting record. Please try again.');
        });
      }
    }

    function searchTable() {
      const input = document.getElementById("searchInput").value.toUpperCase();
      const table = document.getElementById("atlTable");
      const rows = table.getElementsByTagName("tr");

      for (let i = 0; i < rows.length; i++) {
        const columns = rows[i].getElementsByTagName("td");
        if (columns.length > 0) {
          const atlCode = columns[0].innerText.toUpperCase();
          const schoolName = columns[1].innerText.toUpperCase();
          if (atlCode.includes(input) || schoolName.includes(input)) {
            rows[i].style.display = "";
          } else {
            rows[i].style.display = "none";
          }
        }
      }
    }

    function editRecord(id) {
      window.location.href = `editatl.html?id=${id}`;
    }

    // Load records when page loads
    document.addEventListener('DOMContentLoaded', loadATLRecords);
  </script>
</body>
</html>
